<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPORTSBEEP: Founders Release | Cardano ADA Swap (CIP-30 Ready)</title>

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">

    <!-- Cardano Serialization Library (CSL) - Necessary for building transaction bytes -->
    <!-- Note: In a real app, CSL is often bundled, but we include it via CDN for this single-file demonstration. -->
    <script src="https://cdn.jsdelivr.net/npm/@emurgo/cardano-serialization-lib@11.5.0/cardano_serialization_lib.min.js"></script>

    <style>
        /* --- Custom CSS & Color Palette --- */
        :root {
            --c-accent-orange: #F47D30;
            --c-accent-blue: #00539B;
            --c-bg: #04172B; /* Deep Navy */
            --c-bg-light: #002342; /* Lighter navy for cards/sections */
            --c-text: #E5E7EB; /* Light Gray */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-bg);
            color: var(--c-text);
            /* Subtle background texture */
            background-image: radial-gradient(circle at 1px 1px, var(--c-bg-light) 0.5px, transparent 0);
            background-size: 50px 50px;
        }

        .hero-title {
            letter-spacing: -0.05em;
        }

        .wallet-icon {
            width: 28px;
            height: 28px;
            fill: currentColor;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navbar (Fixed) -->
    <nav class="sticky top-0 z-10 bg-[var(--c-bg)]/90 backdrop-blur-sm shadow-xl border-b border-[var(--c-accent-blue)]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-black uppercase text-[var(--c-accent-orange)]">
                        SPORTS<span class="text-white">BEEP</span>
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#swap-section" class="text-sm font-medium text-white hover:text-[var(--c-accent-orange)] transition duration-150">ACCESS SWAP</a>
                    <button onclick="toggleModal()" id="nav-connect-button" class="px-3 py-1.5 text-sm font-semibold rounded-full bg-gray-700 hover:bg-[var(--c-accent-orange)] transition duration-200">
                        Connect Wallet
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-20">

        <!-- 1. Hero Section -->
        <section class="text-center pt-8">
            <p class="text-xl font-bold text-[var(--c-accent-orange)] mb-4 tracking-wider">FOUNDERS RELEASE</p>
            <h2 class="text-7xl md:text-8xl font-black uppercase text-white hero-title mb-6">
                SECURE YOUR <span class="text-[var(--c-accent-orange)]">$BEEP</span>
            </h2>
            <p class="max-w-3xl mx-auto text-lg text-gray-300">
                The official Token of SPORTSBEEP. Daily Fantasy Sports built on the backbone of <a href="https://cardano.org/" class="text-[var(--c-accent-orange)] underline hover:text-white transition duration-200">Cardano</a>. Secure your allocation in this exclusive Founders Release.
            </p>
            <div class="mt-8 flex justify-center space-x-4">
                <a href="#swap-section" class="px-8 py-3 text-lg font-bold rounded-xl text-white bg-[var(--c-accent-orange)] hover:bg-orange-600 transition duration-300 shadow-lg shadow-[var(--c-accent-orange)]/30">
                    ACCESS THE SWAP
                </a>
                <a href="https://sportsbeep.com/whitepaper.html" class="px-8 py-3 text-lg font-medium rounded-xl border-2 border-white/50 text-white hover:border-[var(--c-accent-orange)] hover:text-[var(--c-accent-orange)] transition duration-300">
                    READ WHITEPAPER
                </a>
            </div>
        </section>

        <hr class="border-[var(--c-accent-blue)]/50">

        <!-- 2. WHY SPORTSBEEP (Features Grid) -->
        <section class="space-y-10">
            <h2 class="text-4xl font-extrabold text-center text-white">WHY SPORTSBEEP?</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                
                <!-- Feature Card 1 -->
                <div class="bg-[var(--c-bg-light)] p-6 rounded-xl border border-[var(--c-accent-blue)] shadow-xl space-y-3">
                    <span class="text-4xl text-[var(--c-accent-orange)]">üèÜ</span>
                    <h3 class="text-xl font-bold text-white">DAILY FANTASY</h3>
                    <p class="text-gray-400 text-sm">Play daily, win often. Seamless fantasy sports integration for major leagues.</p>
                </div>

                <!-- Feature Card 2 -->
                <div class="bg-[var(--c-bg-light)] p-6 rounded-xl border border-[var(--c-accent-blue)] shadow-xl space-y-3">
                    <span class="text-4xl text-[var(--c-accent-orange)]">‚Ç≥</span>
                    <h3 class="text-xl font-bold text-white">POWERED BY CARDANO</h3>
                    <p class="text-gray-400 text-sm">Decentralized, low-fee transactions leveraging the security and stability of the <a href="https://cardano.org/" class="text-[var(--c-accent-orange)] underline hover:text-white transition duration-200">Cardano</a> ecosystem.</p>
                </div>
                
                <!-- Feature Card 3 -->
                <div class="bg-[var(--c-bg-light)] p-6 rounded-xl border border-[var(--c-accent-blue)] shadow-xl space-y-3">
                    <span class="text-4xl text-[var(--c-accent-orange)]">üó≥Ô∏è</span>
                    <h3 class="text-xl font-bold text-white">COMMUNITY GOVERNANCE</h3>
                    <p class="text-gray-400 text-sm">Future game modes and feature rollouts are determined by token holders.</p>
                </div>

                <!-- Feature Card 4 -->
                <div class="bg-[var(--c-bg-light)] p-6 rounded-xl border border-[var(--c-accent-blue)] shadow-xl space-y-3">
                    <span class="text-4xl text-[var(--c-accent-orange)]">‚ö°</span>
                    <h3 class="text-xl font-bold text-white">INSTANT REWARDS</h3>
                    <p class="text-gray-400 text-sm">Payouts settled instantly on-chain following contest finalization.</p>
                </div>
            </div>
        </section>

        <hr class="border-[var(--c-accent-blue)]/50">

        <!-- 3. $BEEP TOKENOMICS & ADVANTAGE -->
        <section class="lg:grid lg:grid-cols-3 gap-12">
            
            <!-- Tokenomics Card -->
            <div class="lg:col-span-1 bg-[var(--c-bg-light)] p-8 rounded-xl border border-[var(--c-accent-orange)]/50 shadow-2xl mb-10 lg:mb-0">
                <h3 class="text-3xl font-extrabold text-[var(--c-accent-orange)] mb-6">
                    $BEEP TOKENOMICS
                </h3>
                <p class="text-gray-300 mb-8 text-sm">THE ENGINE</p>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-end border-b border-gray-600 pb-2">
                        <span class="text-2xl font-bold text-white">10M</span>
                        <span class="text-gray-400">TOTAL SUPPLY</span>
                    </div>
                    <div class="flex justify-between items-end border-b border-gray-600 pb-2">
                        <span class="text-2xl font-bold text-white">271</span>
                        <span class="text-gray-400">FOUNDERS RELEASE</span>
                    </div>
                    <div class="flex justify-between items-end pb-2">
                        <span class="text-2xl font-bold text-white">20%</span>
                        <span class="text-gray-400">LOCKED LIQUIDITY POOL</span>
                    </div>
                </div>
                
                <p class="text-xs text-gray-500 mt-6 pt-4 border-t border-gray-700">
                    FULL BREAKDOWN IN WHITEPAPER
                </p>
            </div>

            <!-- Advantage List -->
            <div class="lg:col-span-2 space-y-6">
                <h3 class="text-3xl font-extrabold text-white">THE $BEEP ADVANTAGE</h3>
                
                <div class="space-y-4">
                    <div class="flex items-start space-x-4 bg-[var(--c-bg-light)] p-4 rounded-lg">
                        <span class="text-2xl text-[var(--c-accent-orange)] mt-1">üî•</span>
                        <div>
                            <p class="text-lg font-bold text-white">Deep Player Engagement</p>
                            <p class="text-gray-400 text-sm">High engagement rate among daily fantasy players (DFS), ensuring a vibrant and competitive ecosystem from day one.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 bg-[var(--c-bg-light)] p-4 rounded-lg">
                        <span class="text-2xl text-[var(--c-accent-orange)] mt-1">üõ°Ô∏è</span>
                        <div>
                            <p class="text-lg font-bold text-white">Cardano Foundation</p>
                            <p class="text-gray-400 text-sm">Strong foundation built on <a href="https://cardano.org/" class="text-[var(--c-accent-orange)] underline hover:text-white transition duration-200">Cardano</a>, offering low transaction fees, unparalleled security, and blockchain stability for all operations.</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-4 bg-[var(--c-bg-light)] p-4 rounded-lg">
                        <span class="text-2xl text-[var(--c-accent-orange)] mt-1">üîÅ</span>
                        <div>
                            <p class="text-lg font-bold text-white">Sustainable Retention</p>
                            <p class="text-gray-400 text-sm">Unique reward mechanisms designed for long-term retention and continuous player participation, stabilizing the token economy.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 bg-[var(--c-bg-light)] p-4 rounded-lg">
                        <span class="text-2xl text-[var(--c-accent-orange)] mt-1">üëë</span>
                        <div>
                            <p class="text-lg font-bold text-white">Community Governance</p>
                            <p class="text-gray-400 text-sm">The first DFS platform fully governed by community token holders, giving players a direct say in platform development and future features.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="border-[var(--c-accent-blue)]/50">

        <!-- 4. DISTRIBUTION & MILESTONES -->
        <section class="space-y-10">
            <h2 class="text-4xl font-extrabold text-center text-white">$BEEP DISTRIBUTION & MILESTONES</h2>
            
            <div class="grid lg:grid-cols-2 gap-10">
                
                <!-- Key Metrics -->
                <div class="bg-[var(--c-bg-light)] p-8 rounded-xl border border-white/10 shadow-lg space-y-4">
                    <h3 class="text-2xl font-bold text-white mb-4">Key Metrics</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-lg font-medium">
                            <span class="text-gray-400">Initial Price per $BEEP:</span>
                            <span class="text-[var(--c-accent-orange)] font-bold">$0.12</span>
                        </div>
                        <div class="flex justify-between text-lg font-medium">
                            <span class="text-gray-400">Fixed Total Supply:</span>
                            <span class="text-white font-bold">10,000,000</span>
                        </div>
                        <div class="flex justify-between text-lg font-medium">
                            <span class="text-gray-400">Phase 1 Circulating Supply:</span>
                            <span class="text-white font-bold">271</span>
                        </div>
                        <div class="flex justify-between text-lg font-medium">
                            <span class="text-gray-400">Launch Valuation:</span>
                            <span class="text-white font-bold">$1.2 Million</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 pt-4">Currency Accepted: **ADA** (Primary), with future expansion potential to ETH, USDT, BTC, and others.</p>
                </div>

                <!-- Phased Distribution -->
                <div class="bg-[var(--c-bg-light)] p-8 rounded-xl border border-white/10 shadow-lg">
                    <h3 class="text-2xl font-bold text-white mb-6">Phased Distribution Plan</h3>
                    
                    <ul class="space-y-6">
                        <li class="border-b border-gray-700 pb-3">
                            <p class="font-bold text-[var(--c-accent-orange)]">Phase 1 ‚Äî Micro-Launch (271 $BEEP)</p>
                            <p class="text-sm text-gray-400 mt-1">Objective: Create exclusivity, establish price discovery, and prove tradability. Pool Example: ~49 ADA + 271 $BEEP (anchoring 1 ADA = 5.48 $BEEP).</p>
                        </li>
                        <li class="border-b border-gray-700 pb-3">
                            <p class="font-bold text-white">Phase 2 ‚Äî Expansion (50,000 $BEEP)</p>
                            <p class="text-sm text-gray-400 mt-1">Objective: Deepen liquidity and raise funds for app development.</p>
                        </li>
                        <li class="border-b border-gray-700 pb-3">
                            <p class="font-bold text-white">Phase 3 ‚Äî Community Growth (250,000 $BEEP)</p>
                            <p class="text-sm text-gray-400 mt-1">Objective: Launch staking + referral rewards to incentivize holders.</p>
                        </li>
                    </ul>
                    <p class="text-sm text-gray-500 mt-6">
                        Remaining Supply (6.2M $BEEP) Reserved for future milestones, ecosystem growth, and community incentives.
                    </p>
                </div>
            </div>
        </section>

        <hr class="border-[var(--c-accent-blue)]/50">

        <!-- 5. ACCESS FOUNDERS SWAP (The Interactive Section) -->
        <section id="swap-section" class="pt-8">
            <div class="max-w-md mx-auto bg-[var(--c-bg-light)] p-8 rounded-2xl border-2 border-[var(--c-accent-orange)] shadow-2xl shadow-[var(--c-accent-orange)]/20 space-y-6">
                
                <h2 class="text-3xl font-black text-center text-white">ACCESS FOUNDERS SWAP</h2>
                
                <!-- Rate Input - NEW FEATURE -->
                <div class="space-y-3">
                    <label for="new-swap-rate" class="text-sm font-medium text-gray-400 block">SET $BEEP RECEIVED PER 1 ADA</label>
                    <input type="number" id="new-swap-rate" value="5.48" min="0.01" step="0.01"
                            class="w-full p-4 rounded-xl bg-gray-900/80 text-white border border-gray-700 text-2xl font-mono
                            focus:border-[var(--c-accent-orange)] focus:ring-[var(--c-accent-orange)] focus:outline-none"
                            oninput="handleRateChange()">
                    <p class="text-xs text-gray-500 text-right">Adjust this to test different starting prices.</p>
                </div>
                
                <p id="current-rate-display" class="text-center text-xl font-bold text-[var(--c-accent-orange)]">RATE: Loading...</p>

                <!-- Wallet Connection Status -->
                <div id="wallet-display" class="bg-gray-800/50 p-3 rounded-lg flex justify-between items-center text-sm font-medium border border-gray-700">
                    <span id="wallet-status" class="flex items-center space-x-2 text-red-400">
                        <svg id="status-icon" class="w-4 h-4 text-red-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 10l4 4m0 -4l-4 4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                        <span>CIP-30 Wallet Disconnected</span>
                    </span>
                    <button onclick="toggleModal()" id="swap-connect-button" class="px-3 py-1 bg-[var(--c-accent-orange)] text-white text-xs rounded-full hover:bg-orange-600 transition">
                        Connect
                    </button>
                </div>

                <!-- Swap Input -->
                <div class="space-y-3">
                    <label for="ada-amount" class="text-sm font-medium text-gray-400 block">AMOUNT OF ADA TO SWAP</label>
                    <input type="number" id="ada-amount" value="50" min="1" step="1"
                            class="w-full p-4 rounded-xl bg-gray-900/80 text-white border border-gray-700 text-2xl font-mono
                            focus:border-[var(--c-accent-orange)] focus:ring-[var(--c-accent-orange)] focus:outline-none"
                            placeholder="50">
                </div>

                <!-- Result Display (BEEP) -->
                <div class="bg-gray-800/50 p-4 rounded-xl border border-[var(--c-accent-blue)]">
                    <p class="text-sm text-gray-400">You Receive (Approx.)</p>
                    <p id="beep-result" class="text-4xl font-extrabold text-green-400 mt-1">0.00 $BEEP</p>
                </div>

                <!-- Execute Swap Button -->
                <button onclick="executeSwap()" id="execute-swap-button" disabled
                        class="w-full py-4 text-xl font-extrabold rounded-xl bg-gray-600 text-gray-300
                        transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed
                        hover:bg-[var(--c-accent-orange)] hover:text-white">
                    EXECUTE SWAP FOR $BEEP
                </button>

                <!-- Warning -->
                <div class="p-3 bg-red-900/40 border border-red-600/50 rounded-lg text-sm text-red-300">
                    <p class="font-bold">WARNING:</p>
                    <p>All $BEEP purchases are **FINAL** and **NON-REFUNDABLE**. Token price is locked for this Founders Release phase only. Ensure you are using a secure, supported <a href="https://cardano.org/" class="text-[var(--c-accent-orange)] underline hover:text-white transition duration-200">Cardano</a> wallet.</p>
                </div>

            </div>
        </section>

    </main>

    <!-- Modal for Wallet Selection (Hidden by default) -->
    <div id="wallet-modal" class="fixed inset-0 z-20 hidden bg-black bg-opacity-70 flex items-center justify-center p-4" onclick="closeModal(event)">
        <div class="bg-[var(--c-bg-light)] w-full max-w-sm p-6 rounded-xl shadow-2xl border border-[var(--c-accent-blue)]" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">Select CIP-30 Wallet</h3>

            <!-- Wallet Buttons: The data-wallet name must match the window.cardano.<name> property -->
            <div id="wallet-list" class="space-y-4">
                <p class="text-gray-400 text-center">Checking for available wallets...</p>
                <!-- Dynamic wallet buttons will be inserted here -->
            </div>
            
            <button onclick="toggleModal()" class="w-full mt-6 py-2 bg-gray-700 rounded-lg text-sm text-gray-300 hover:bg-gray-600 transition">Close</button>
        </div>
    </div>
    
    <!-- Toast/Modal for Transaction Confirmation -->
    <div id="toast-message" class="fixed bottom-6 right-6 p-4 rounded-xl shadow-2xl transition-opacity duration-300 hidden opacity-0 text-white max-w-sm"></div>

    <!-- Footer -->
    <footer class="mt-20 py-8 border-t border-[var(--c-accent-blue)]/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6">
            
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div class="text-lg font-black uppercase text-[var(--c-accent-orange)]">
                    SPORTS<span class="text-white">BEEP</span>
                </div>
                
                <div class="flex space-x-4 text-gray-400">
                    <a href="#" class="hover:text-[var(--c-accent-orange)] transition">X</a>
                    <a href="#" class="hover:text-[var(--c-accent-orange)] transition">Discord</a>
                    <a href="#" class="hover:text-[var(--c-accent-orange)] transition">Telegram</a>
                </div>
            </div>

            <p class="text-xs text-gray-500 text-center">
                Designed and Engineered by <a href="https://ladmedia.co" class="hover:text-[var(--c-accent-orange)] transition duration-200">LAD MEDIA</a>.
            </p>
            
            <!-- Legal Disclaimer -->
            <div class="pt-4 text-xs text-gray-500 space-y-2 border-t border-gray-700">
                <p class="font-bold text-white">Legal Disclaimer & Terms of Service Summary</p>
                <p>**RISK WARNING:** Digital assets, including cryptocurrencies and tokens like $BEEP, are highly volatile, carry significant risk, and may not be suitable for all investors. The value can fluctuate dramatically. You should carefully consider whether trading or holding digital assets is suitable for you in light of your financial condition.</p>
                <p>**SALES FINALITY:** All token purchases made through this Founders Release swap mechanism are **FINAL** and **NON-REFUNDABLE**. By executing a transaction, you confirm that you have read and agreed to the full terms and conditions (available in the Whitepaper).</p>
                <p>**USER RESPONSIBILITY:** You are solely responsible for securing your wallet seed phrase and private keys. <a href="https://ladmedia.co" class="hover:text-white transition duration-200 underline">LAD MEDIA</a> and SPORTSBEEP are not responsible for lost, stolen, or compromised digital assets.</p>
            </div>
            
            <p class="text-center text-xs text-gray-500 pt-4">¬© 2026 SPORTSBEEP. All rights reserved.</p>

        </div>
    </footer>

    <!-- JavaScript (CIP-30 Implementation) -->
    <script>
        // --- CIP-30 and Application State ---
        
        // This code now relies *entirely* on the browser-injected window.cardano object
        // provided by real extensions like Yoroi, Nami, Lace, etc.
        
        const SWAP_RATE_DEFAULT = 5.48; // Default rate for 1 ADA = X $BEEP
        const SWAP_RECEIVING_ADDRESS = 'addr1q93z...'; // The address where user ADA is sent (mock for now)
        const BEEP_POLICY_ID = '3a3399b1a5e18260b411d87a412c96c14106323c965c490a02f37e40'; // Mock Policy ID
        const BEEP_ASSET_NAME_HEX = '2442454550'; // Hex for "$BEEP"

        let walletApi = null; // The CIP-30 API object from the connected wallet
        let userAddress = null;
        let walletName = null;

        // --- DOM Elements ---
        const modal = document.getElementById('wallet-modal');
        const walletList = document.getElementById('wallet-list');
        const walletStatus = document.getElementById('wallet-status');
        const swapButton = document.getElementById('execute-swap-button');
        const navConnectButton = document.getElementById('nav-connect-button');
        const swapConnectButton = document.getElementById('swap-connect-button');
        const adaAmountInput = document.getElementById('ada-amount');
        const beepResult = document.getElementById('beep-result');
        const toastMessage = document.getElementById('toast-message');
        const rateDisplay = document.getElementById('current-rate-display');
        const rateInput = document.getElementById('new-swap-rate'); 

        /**
         * Toggles the wallet selection modal visibility.
         */
        function toggleModal() {
            if (!walletApi) {
                // Populate the wallet list only if the modal is shown and we aren't connected
                populateWalletList();
            }
            modal.classList.toggle('hidden');
        }

        /**
         * Closes the modal, only if the click is outside the content.
         */
        function closeModal(event) {
            if (event.target === modal) {
                modal.classList.add('hidden');
            }
        }

        /**
         * Populates the wallet list in the modal based on window.cardano.
         * This function will detect your real Yoroi wallet.
         */
        function populateWalletList() {
            // Check if window.cardano exists (in case no extensions are installed)
            if (typeof window.cardano === 'undefined') {
                walletList.innerHTML = '<p class="text-red-400 text-center">No CIP-30 wallets found. Please install a Cardano wallet extension (like Yoroi).</p>';
                return;
            }

            // Filter for available and enabled-ready wallets
            const availableWallets = Object.keys(window.cardano).filter(key => 
                typeof window.cardano[key] === 'object' && typeof window.cardano[key].enable === 'function'
            );

            if (availableWallets.length === 0) {
                walletList.innerHTML = '<p class="text-red-400 text-center">No CIP-30 wallets detected. Ensure your extension is active.</p>';
                return;
            }

            walletList.innerHTML = availableWallets.map(walletKey => {
                const wallet = window.cardano[walletKey];
                // Check if the name and version are available, often they are for real extensions
                const name = wallet.name || walletKey.charAt(0).toUpperCase() + walletKey.slice(1);
                const version = wallet.version || '1.0';

                return `
                    <button data-wallet="${walletKey}" onclick="connectWallet('${walletKey}')" class="w-full flex items-center justify-between p-4 bg-gray-800 rounded-xl hover:bg-gray-700 transition">
                        <div class="flex items-center space-x-3">
                            <!-- In a real app, you could use wallet.icon if provided as SVG data -->
                            <span class="wallet-icon text-[var(--c-accent-orange)]">‚Ç≥</span>
                            <span class="font-semibold text-lg">${name}</span>
                        </div>
                        <span class="text-xs text-gray-400">v${version}</span>
                    </button>
                `;
            }).join('');
        }

        /**
         * Initiates the CIP-30 connection process with the real extension.
         * @param {string} key The key of the wallet object (e.g., 'yoroi', 'nami').
         */
        window.connectWallet = async function(key) {
            if (!window.cardano || !window.cardano[key]) {
                showToast(`Wallet ${key} API not detected.`, 'error');
                return;
            }

            try {
                // 1. Request access (CIP-30 enable call to your extension)
                walletApi = await window.cardano[key].enable();
                walletName = window.cardano[key].name || key;

                // 2. Get user address
                // This is a direct CIP-30 call to Yoroi/Nami/etc.
                const addresses = await walletApi.getUsedAddresses();
                const addressHex = addresses[0];

                // 3. Convert address to Bech32 for display (conceptual)
                // CSL is loaded, but converting a hex address to a human-readable Bech32 address
                // is complex. We'll truncate for display confidence.
                userAddress = addressHex ? addressHex.slice(0, 10) + '...' + addressHex.slice(-5) : 'Unknown Address';

                // 4. Update UI
                updateUIConnected();
                toggleModal();
                showToast(`Successfully connected to ${walletName}. Address: ${userAddress}`, 'success');

            } catch (error) {
                console.error("Wallet connection failed:", error);
                // When you deny the connection in the extension, it throws an error
                const errorMessage = error.message || error.info || 'Connection denied by user or failed.';
                showToast(`Connection failed: ${errorMessage}`, 'error');
                updateUIDisconnected();
            }
        }

        /**
         * Updates the UI state to CONNECTED.
         */
        function updateUIConnected() {
            walletStatus.innerHTML = `<svg class="w-4 h-4 text-green-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14 10 12"></polyline></svg>
                                        <span>Connected: ${walletName}</span>`;
            walletStatus.classList.remove('text-red-400');
            walletStatus.classList.add('text-green-400');
            
            swapButton.disabled = false;
            swapButton.classList.remove('bg-gray-600', 'text-gray-300');
            swapButton.classList.add('bg-[var(--c-accent-orange)]', 'text-white');
            
            navConnectButton.textContent = 'Disconnect';
            swapConnectButton.textContent = 'Change';
        }
        
        /**
         * Updates the UI state to DISCONNECTED.
         */
        function updateUIDisconnected() {
            walletApi = null;
            userAddress = null;
            walletName = null;
            
            walletStatus.innerHTML = `<svg class="w-4 h-4 text-red-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 10l4 4m0 -4l-4 4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                        <span>CIP-30 Wallet Disconnected</span>`;
            walletStatus.classList.remove('text-green-400');
            walletStatus.classList.add('text-red-400');

            swapButton.disabled = true;
            swapButton.classList.remove('bg-[var(--c-accent-orange)]', 'text-white');
            swapButton.classList.add('bg-gray-600', 'text-gray-300');

            navConnectButton.textContent = 'Connect Wallet';
            swapConnectButton.textContent = 'Connect';
        }

        /**
         * Handles changes in the swap rate input, updates the display, and triggers BEEP calculation.
         */
        window.handleRateChange = function() {
            let newRate = parseFloat(rateInput.value);

            // Validation and resetting to default if invalid
            if (isNaN(newRate) || newRate <= 0) {
                newRate = SWAP_RATE_DEFAULT;
                rateInput.value = SWAP_RATE_DEFAULT; 
            }
            
            // Limit to two decimal places for display clarity
            rateDisplay.textContent = `RATE: 1 ADA = ${newRate.toFixed(2)} $BEEP`;
            
            // Trigger the BEEP amount calculation
            updateBEEP();
        }

        /**
         * Updates the BEEP received based on the ADA input and the current dynamic swap rate.
         */
        function updateBEEP() {
            // Read rate dynamically from the input field
            const currentRate = parseFloat(rateInput.value) || SWAP_RATE_DEFAULT;
            const ada = parseFloat(adaAmountInput.value);
            
            if (!isNaN(ada) && ada > 0) {
                // Use 0 decimal places for tokens (assuming $BEEP is not fractional)
                const beep = (ada * currentRate).toFixed(0); 
                beepResult.textContent = `${beep} $BEEP`;
            } else {
                beepResult.textContent = '0.00 $BEEP';
            }
        }

        /**
         * Implements the CIP-30 Transaction Flow (Build, Sign, Submit).
         */
        window.executeSwap = async function() {
            if (!walletApi) {
                showToast('Please connect a CIP-30 wallet first.', 'error');
                return;
            }

            const adaAmount = parseFloat(adaAmountInput.value);
            if (isNaN(adaAmount) || adaAmount < 5) { // Minimum ADA for transaction + min UTXO
                showToast('Minimum ADA for swap is 5 ADA.', 'error');
                return;
            }

            // Get the live rate for the transaction simulation
            const liveRate = parseFloat(rateInput.value) || SWAP_RATE_DEFAULT;
            const beepAmount = (adaAmount * liveRate).toFixed(0); // Use 0 for whole tokens
            const adaLovelace = adaAmount * 1_000_000;
            
            swapButton.textContent = 'Building Transaction...';
            swapButton.disabled = true;

            try {
                // NOTE: In a real app, you would use CSL or a backend service to:
                // 1. Fetch UTXOs from the connected wallet (walletApi.getUtxos())
                // 2. Build a valid TransactionBody (using CardanoWasm.TransactionBuilder)
                //    - This step includes calculating network fees, min-UTXO values, and change outputs.
                
                // --- Conceptual Transaction Building ---
                console.log('Using CSL to build transaction conceptually...');
                const mockTxCbor = 'a0018301...'; // Placeholder for the actual raw CBOR transaction structure
                
                // --- 3. REQUEST SIGNATURE (CIP-30: This calls your real Yoroi/Nami wallet!) ---
                swapButton.textContent = 'Awaiting Wallet Signature... (Approve in Extension)';

                const signedTxCbor = await walletApi.signTx(mockTxCbor, false); 

                // --- 4. SUBMIT TRANSACTION (CIP-30: This sends the signed transaction to the network via your wallet's API) ---
                swapButton.textContent = 'Submitting to Cardano Network...';
                
                // Since this transaction CBOR is mocked, the submission will likely fail with a real wallet.
                // However, this confirms the wallet is functional and responsive.
                const txHash = await walletApi.submitTx(signedTxCbor);
                
                // Success (If this step completes, the CIP-30 pipeline is working)
                console.log("Transaction Successful! Hash:", txHash);
                showToast(`Swap submitted! Tx Hash: ${txHash.slice(0, 20)}... You received ${beepAmount} $BEEP.`, 'success');

            } catch (error) {
                console.error("CIP-30 Transaction failed:", error);
                const errorMessage = error.message || (error.info ? JSON.stringify(error.info) : 'Transaction denied or failed.');
                showToast(`Transaction Failed: ${errorMessage}`, 'error');
            } finally {
                // Re-enable the button
                // We'll leave it disabled only if the wallet is disconnected (checked by updateUIConnected)
                if (walletApi) {
                     swapButton.textContent = 'EXECUTE SWAP FOR $BEEP';
                     swapButton.disabled = false;
                }
            }
        }
        
        /**
         * Handles disconnect logic for the main button.
         */
        navConnectButton.addEventListener('click', () => {
            if (navConnectButton.textContent === 'Disconnect') {
                updateUIDisconnected();
                showToast('Wallet disconnected.', 'error');
            } else {
                toggleModal();
            }
        });


        /**
         * Displays a temporary notification (toast).
         */
        function showToast(message, type) {
            toastMessage.textContent = message;
            toastMessage.classList.remove('hidden', 'opacity-0', 'bg-red-700', 'bg-green-700');
            toastMessage.classList.add(type === 'success' ? 'bg-green-700' : 'bg-red-700', 'opacity-100');

            setTimeout(() => {
                toastMessage.classList.remove('opacity-100');
                toastMessage.classList.add('opacity-0');
                setTimeout(() => toastMessage.classList.add('hidden'), 300);
            }, 5000);
        }
        
        /**
         * Runs on initial load to set up the rate and event listeners.
         */
        window.onload = function() {
            // Initialize the rate input and display using the default
            rateInput.value = SWAP_RATE_DEFAULT;
            handleRateChange(); 

            // Listen for input change to update BEEP amount
            adaAmountInput.addEventListener('input', updateBEEP);
        };

    </script>
</body>
</html>
